<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>WB Monitoring PRO</title>
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/vant@4/lib/index.css"/>
    <script src="https://fastly.jsdelivr.net/npm/vue@3"></script>
    <script src="https://fastly.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
        :root { --van-background-2: #121212; --van-nav-bar-background: #1a1a1a; --van-nav-bar-title-text-color: #fff; }
        body { background-color: #000; margin: 0; color: #fff; font-family: -apple-system, sans-serif; -webkit-user-select: none; }
        .chart-card { background: #1a1a1a; border-radius: 20px; border: 1px solid #333; margin-bottom: 12px; padding: 10px; }
        .gauge-box { width: 100%; height: 220px; }
        .status-header { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; background: #111; }
        .adaptive-label { font-size: 12px; font-weight: 800; }
        .pulse { animation: pulse-red 1s infinite; color: #ff4d4f; }
        @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        .log-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; font-size: 13px; }
        .crit { color: #ff4d4f; }
    </style>
</head>
<body>
<div id="app">
    <van-nav-bar title="Wiren Board PRO" border="false"></van-nav-bar>
    
    <div class="status-header">
        <div class="adaptive-label" :class="{pulse: isAdaptive}">
            {{ isAdaptive ? '● АДАПТИВНЫЙ РЕЖИМ (4Гц)' : '● РЕЖИМ: НОРМА' }}
        </div>
        <van-tag color="#333" text-color="#888">SD: 25/64 GB</van-tag>
    </div>

    <div style="padding: 12px; padding-bottom: 80px;">
        <div class="chart-card">
            <div id="u-gauge" class="gauge-box"></div>
        </div>

        <div class="chart-card" style="padding: 15px;">
            <div style="font-weight: bold; margin-bottom: 10px; color: #888;">Журнал (ТЗ 2.4)</div>
            <div v-for="l in logs" :key="l.id" class="log-item" :class="{crit: l.type==='crit'}">
                <span>{{l.time}} - {{l.msg}}</span>
                <span>{{l.val}}</span>
            </div>
        </div>
    </div>

    <van-tabbar v-model="active" active-color="#f0821d" inactive-color="#444">
        <van-tabbar-item icon="chart-trending-o">Обзор</van-tabbar-item>
        <van-tabbar-item icon=" records-o">Логи</van-tabbar-item>
        <van-tabbar-item icon="setting-o">Админ</van-tabbar-item>
    </van-tabbar>
</div>

<script>
    const { createApp, ref, onMounted } = Vue;
    createApp({
        setup() {
            const active = ref(0);
            const isAdaptive = ref(false);
            const logs = ref([
                { id: 1, time: '10:35', msg: 'ПЕРЕКОС ФАЗ', val: '12%', type: 'crit' },
                { id: 2, time: '10:30', msg: 'СЕТЬ ОК', val: '50.0Гц', type: 'ok' }
            ]);

            onMounted(() => {
                const chart = echarts.init(document.getElementById('u-gauge'), 'dark');
                const option = {
                    backgroundColor: 'transparent',
                    series: [
                        {
                            type: 'gauge',
                            center: ['50%', '55%'],
                            startAngle: 200, endAngle: -20,
                            min: 190, max: 250,
                            splitNumber: 6,
                            itemStyle: { color: '#f0821d' },
                            progress: { show: true, width: 12 },
                            pointer: { icon: 'path://M12.8 1.3l1.2 1.2L8.9 7.6l-1.2-1.2L12.8 1.3z', width: 6, length: '70%' },
                            axisLine: { lineStyle: { width: 12, color: [[0.33, '#ff4d4f'], [0.66, '#f0821d'], [1, '#ff4d4f']] } },
                            axisLabel: { distance: 20, color: '#666', fontSize: 10 },
                            anchor: { show: true, size: 12, itemStyle: { borderColor: '#f0821d', borderWidth: 2 } },
                            title: { offsetCenter: [0, '35%'], fontSize: 14, color: '#888' },
                            detail: { valueAnimation: true, offsetCenter: [0, '70%'], fontSize: 28, fontWeight: '800', color: '#fff', formatter: '{value}V' },
                            data: [{ value: 230, name: 'ФАЗА A (RMS)' }]
                        }
                    ]
                };
                chart.setOption(option);

                setInterval(() => {
                    const v = +(205 + Math.random() * 45).toFixed(1);
                    isAdaptive.value = v < 210 || v > 245;
                    chart.setOption({ series: [{ data: [{ value: v, name: 'ФАЗА A (RMS)' }] }] });
                }, 2000);
            });
            return { active, isAdaptive, logs };
        }
    }).use(vant).mount('#app');
</script>
</body>
</html>
